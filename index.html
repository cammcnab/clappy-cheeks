<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, viewport-fit=cover"
		/>
		<meta name="robots" content="noindex, nofollow" />
		<meta name="googlebot" content="noindex, nofollow" />
		<title>Clappy Cheeks!!</title>
		<link
			href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap"
			rel="stylesheet"
		/>
		<link
			href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@300&display=swap"
			rel="stylesheet"
		/>
		<link
			href="https://fonts.googleapis.com/css2?family=PT+Serif:ital,wght@1,700&display=swap"
			rel="stylesheet"
		/>
		<style>
			/* Base touch handling for all elements */
			*,
			*::before,
			*::after {
				touch-action: manipulation;
				-webkit-touch-callout: none;
				-webkit-user-select: none;
				user-select: none;
				-webkit-tap-highlight-color: transparent;
				box-sizing: border-box;
				margin: 0;
				padding: 0;
			}

			/* Common properties for fixed positioning */
			html,
			body {
				height: 100%;
				width: 100%;
				overflow: hidden;
				position: fixed;
			}

			/* Common properties for game containers */
			.canvas-container,
			.game-wrapper,
			#gameCanvas {
				position: absolute;
				width: 100%;
				height: 100%;
				left: 0;
				top: 0;
				background: #000;
				will-change: transform;
				transform: translateZ(0);
				backface-visibility: hidden;
			}

			/* Common properties for buttons */
			.dpad-button,
			.action-button,
			.control-button {
				cursor: pointer;
				position: relative;
				display: flex;
				align-items: center;
				justify-content: center;
			}

			/* Common properties for power groups */
			.power-group-desktop,
			.power-group-mobile {
				display: flex;
				align-items: center;
				gap: 8px;
			}

			/* Common properties for speaker grilles */
			.speaker-grille,
			.speaker-grille-right {
				background-image: var(--noise-texture),
					repeating-linear-gradient(
						90deg,
						#222,
						#222 2px,
						#1a1a1a 2px,
						#1a1a1a 4px
					);
				border-radius: 6px;
				border: 1px solid #333;
				box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3),
					0 1px 1px rgba(255, 255, 255, 0.05);
			}

			/* Base TV sizing variables */
			:root {
				--tv-padding: 20px;
				--bezel-radius: 24px;
				--noise-texture: url('data:image/svg+xml,<svg viewBox="0 0 500 500" xmlns="http://www.w3.org/2000/svg"><filter id="noise"><feTurbulence type="fractalNoise" baseFrequency="2.5" numOctaves="4" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23noise)" opacity="0.08"/></svg>');
			}

			/* Tablet sizes */
			@media (max-width: 1024px) {
				:root {
					--tv-padding: 16px;
					--bezel-radius: 20px;
				}
			}

			/* Mobile sizes */
			@media (max-width: 768px) {
				:root {
					--tv-padding: 12px;
					--bezel-radius: 16px;
				}
			}

			html {
				touch-action: manipulation;
				height: 100%;
				overflow: hidden;
				position: fixed;
				width: 100%;
			}

			body {
				touch-action: manipulation;
				height: 100%;
				overflow: hidden;
				position: fixed;
				width: 100%;
				display: flex;
				justify-content: center;
				align-items: center;
				background-color: #000;
				font-family: 'Press Start 2P', cursive;
				-webkit-tap-highlight-color: transparent;
			}

			.tv-container {
				position: relative;
				width: 100%;
				height: 100%;
				display: flex;
				justify-content: center;
				align-items: center;
				overflow: hidden;
			}

			.monitor-frame {
				position: relative;
				width: 100%;
				height: 100%;
				background: #2a2a2a;
				box-shadow: inset 0 0 2px rgba(255, 255, 255, 0.1),
					0 5px 15px rgba(0, 0, 0, 0.5);
				background-image: var(--noise-texture),
					linear-gradient(
						180deg,
						#2a2a2a 0%,
						#252525 20%,
						#2a2a2a 50%,
						#252525 80%,
						#222 100%
					);
				display: flex;
				flex-direction: column;
			}

			/* Main screen bezel */
			.inner-bezel {
				position: relative;
				flex: 1;
				margin: var(--tv-padding);
				background: #1a1a1a;
				border-radius: var(--bezel-radius);
				overflow: hidden;
				background-image: var(--noise-texture),
					linear-gradient(
						45deg,
						#1a1a1a 0%,
						#202020 25%,
						#1a1a1a 50%,
						#151515 75%,
						#1a1a1a 100%
					);
				box-shadow: inset 0 0 2px rgba(255, 255, 255, 0.05),
					inset 0 0 20px rgba(0, 0, 0, 0.5);
			}

			/* Screen mask and container */
			.canvas-container {
				position: absolute;
				inset: calc(var(--tv-padding) * 0.4);
				overflow: hidden;
				border-radius: calc(var(--bezel-radius) * 4);
				background: #000000;
				touch-action: manipulation;
				-webkit-touch-callout: none;
				-webkit-user-select: none;
				user-select: none;
			}

			/* Game wrapper */
			.game-wrapper {
				position: absolute;
				width: 100%;
				height: 100%;
				left: 0;
				top: 0;
				display: flex;
				justify-content: center;
				align-items: center;
				overflow: hidden;
				background: #000000;
				touch-action: manipulation;
				-webkit-touch-callout: none;
				-webkit-user-select: none;
				user-select: none;
				will-change: filter;
				transform: translateZ(0);
				backface-visibility: hidden;
			}

			/* Game canvas */
			#gameCanvas {
				position: absolute;
				touch-action: manipulation;
				-webkit-touch-callout: none;
				-webkit-user-select: none;
				user-select: none;
				left: 0;
				width: 100%;
				height: 100%;
				top: 0;
				right: 0;
				bottom: 0;
				background: #000;
				z-index: 1;
				will-change: transform;
				transform: translateZ(0);
				backface-visibility: hidden;
			}

			/* Control panel area */
			.control-panel {
				background: linear-gradient(to bottom, #2a2a2a, #222);
				border-top: 1px solid #333;
				display: flex;
				flex-direction: row;
				align-items: center;
				padding: var(--tv-padding);
				background-image: var(--noise-texture),
					linear-gradient(
						180deg,
						#2a2a2a 0%,
						#252525 30%,
						#222 70%,
						#1a1a1a 100%
					);
				box-shadow: inset 0 1px 2px rgba(255, 255, 255, 0.1),
					0 -1px 3px rgba(0, 0, 0, 0.2);
			}

			.top-row {
				flex: 1;
				display: flex;
				align-items: center;
				justify-content: flex-start;
				gap: 20px;
				height: 32px;
				position: relative;
				padding: 0;
			}

			.speaker-grille {
				width: 100px;
				height: 32px;
				margin-right: 20px;
			}

			.controls {
				display: flex;
				gap: 8px;
				padding: 0;
				min-width: 240px;
				justify-content: flex-end;
			}

			.control-button {
				width: 72px;
				height: 36px;
			}

			.power-group-desktop {
				order: 1;
			}

			/* Base styles for elements that only show on touch */
			.gamepad-row,
			.speaker-grille-right,
			.power-group-mobile {
				display: none;
			}

			/* Responsive layout changes */
			@media (max-width: 768px) {
				.control-panel {
					flex-direction: column;
					gap: 12px;
					justify-content: center;
				}

				.top-row {
					width: 100%;
					justify-content: space-between;
					gap: 0;
					height: 32px;
				}

				.speaker-grille {
					width: 80px;
					height: 24px;
					margin: 0;
				}

				/* Move power to right side on non-touch devices */
				:not(.touch-device) .power-group-desktop {
					order: 3; /* Places it after the logo */
					margin: 0;
				}

				.controls {
					height: 32px;
					gap: 6px;
					justify-content: stretch;
					width: 100%;
				}

				.control-button {
					height: 32px;
					font-size: 11px;
					flex: 1;
					padding: 0 8px;
				}
			}

			/* Touch device specific changes */
			.touch-device .speaker-grille-right {
				display: block;
				width: 80px;
				height: 24px;
			}

			.touch-device .power-group-desktop {
				display: none;
			}

			.touch-device .power-group-mobile {
				display: flex;
				position: absolute;
				left: 50%;
				top: 50%;
				transform: translate(-50%, -50%);
				flex-direction: column;
				align-items: center;
				gap: 4px;
				z-index: 2;
			}

			.touch-device .gamepad-row {
				display: flex;
				order: -1;
				position: relative;
				padding: 0;
				justify-content: space-between;
				align-items: center;
			}

			.touch-device .control-panel {
				flex-direction: column;
				gap: 12px;
				justify-content: center;
			}

			/* Brand logo */
			.brand-logo {
				position: absolute;
				left: 50%;

				transform: translateX(-50%);
				font-family: 'PT Serif', serif;
				font-size: 20px;
				letter-spacing: 0.12em;
				background: repeating-linear-gradient(
						-45deg,
						rgba(255, 255, 255, 0.05) 0px,
						rgba(255, 255, 255, 0.05) 1px,
						transparent 1px,
						transparent 2px
					),
					linear-gradient(
						180deg,
						#ccc 0%,
						#999 30%,
						#bbb 50%,
						#888 70%,
						#999 100%
					);
				-webkit-background-clip: text;
				background-clip: text;
				color: transparent;
				text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
				opacity: 0.85;
				font-weight: 700;
				font-style: italic;
				white-space: nowrap;
				z-index: 2;
			}

			/* Speaker grille */
			.speaker-grille {
				height: 32px;
				width: 100px;
				background-image: var(--noise-texture),
					repeating-linear-gradient(
						90deg,
						#222,
						#222 2px,
						#1a1a1a 2px,
						#1a1a1a 4px
					);
				border-radius: 6px;
				border: 1px solid #333;
				box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3),
					0 1px 1px rgba(255, 255, 255, 0.05);
			}

			.speaker-grille-right {
				display: none;
			}

			/* Power indicator groups */
			.power-group-desktop {
				display: flex;
				align-items: center;
				gap: 8px;
				height: 32px;
			}

			.power-group-mobile {
				display: none;
				position: absolute;
				left: 50%;
				top: 50%;
				transform: translate(-50%, -50%);
				flex-direction: column;
				align-items: center;
				gap: 4px;
			}

			/* Controls row */
			.controls {
				display: flex;
				gap: 8px;
				padding: 0;
			}

			/* Disabled share button */
			#shareButton:disabled {
				cursor: not-allowed;
				opacity: 0.15;
				background: #0a0a0a;
				border-color: #1a1a1a;
				color: #333;
				box-shadow: inset 0 1px 4px rgba(0, 0, 0, 0.4);
				transform: scale(0.95);
			}

			#shareButton:disabled::before {
				opacity: 0;
			}

			/* Active share button */
			#shareButton.share-ready {
				animation: shareButtonBlink 1.2s ease-in-out infinite;
				opacity: 1;
				cursor: pointer;
				transform: scale(1);
				transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
				filter: none;
			}

			@keyframes shareButtonBlink {
				0%,
				100% {
					background-image: var(--noise-texture),
						linear-gradient(180deg, #330000 0%, #220000 40%, #110000 100%);
					box-shadow: inset 0 1px 2px rgba(255, 0, 0, 0.1),
						0 1px 2px rgba(0, 0, 0, 0.2), inset 0 0 0 1px rgba(255, 0, 0, 0.1),
						0 0 15px rgba(255, 0, 0, 0.3);
					text-shadow: 0 0 8px rgba(255, 0, 0, 0.5);
					border-color: #660000;
				}
				50% {
					background-image: var(--noise-texture),
						linear-gradient(180deg, #ff0000 0%, #cc0000 40%, #990000 100%);
					box-shadow: inset 0 1px 2px rgba(255, 255, 255, 0.3),
						0 1px 2px rgba(0, 0, 0, 0.2),
						inset 0 0 0 1px rgba(255, 255, 255, 0.3),
						0 0 30px rgba(255, 0, 0, 0.6);
					text-shadow: 0 0 15px rgba(255, 255, 255, 0.9);
					border-color: #ff3333;
				}
			}

			/* Remove hover effects for disabled button */
			#shareButton:disabled:hover {
				background: #0a0a0a;
				box-shadow: inset 0 1px 4px rgba(0, 0, 0, 0.4);
			}

			/* Specific hover for active share button */
			#shareButton.share-ready:hover {
				animation: none;
				background: #ff0000;
				background-image: var(--noise-texture),
					linear-gradient(180deg, #ff3333 0%, #ff0000 40%, #cc0000 100%);
				filter: brightness(1.2);
				box-shadow: inset 0 1px 2px rgba(255, 255, 255, 0.4),
					0 0 30px rgba(255, 0, 0, 0.6);
				border-color: #ff6666;
				color: white;
				text-shadow: 0 0 15px rgba(255, 255, 255, 0.9);
			}

			.control-button:hover {
				background-image: var(--noise-texture),
					linear-gradient(180deg, #1d1d1d 0%, #171717 40%, #131313 100%);
				box-shadow: inset 0 1px 3px rgba(255, 255, 255, 0.07),
					0 1px 2px rgba(0, 0, 0, 0.2),
					inset 0 0 0 1px rgba(255, 255, 255, 0.07);
				color: #fff;
			}

			.control-button:active {
				transform: translateY(1px);
				background-image: var(--noise-texture),
					linear-gradient(180deg, #151515 0%, #111 40%, #0d0d0d 100%);
				box-shadow: inset 0 1px 4px rgba(0, 0, 0, 0.3),
					0 1px 1px rgba(0, 0, 0, 0.1), inset 0 0 0 1px rgba(0, 0, 0, 0.2);
			}

			.control-button::before {
				content: '';
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				height: 40%;
				background: linear-gradient(
					180deg,
					rgba(255, 255, 255, 0.04) 0%,
					rgba(255, 255, 255, 0) 100%
				);
				border-radius: calc(var(--bezel-radius) * 0.1)
					calc(var(--bezel-radius) * 0.1) 0 0;
				pointer-events: none;
			}

			.control-button:disabled {
				cursor: not-allowed;
				opacity: 0.15;
				background-image: var(--noise-texture),
					linear-gradient(180deg, #0a0a0a 0%, #080808 40%, #050505 100%);
				border-color: #1a1a1a;
				color: #333;
				box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3);
				transform: scale(0.95);
				filter: grayscale(100%);
				transition: all 0.3s ease-out;
			}

			.control-button:disabled::before {
				opacity: 0.1;
			}

			.control-button.share-ready {
				animation: shareButtonBlink 1.5s ease-in-out infinite;
				opacity: 1;
				cursor: pointer;
				color: #fff;
				text-shadow: 0 0 10px rgba(255, 0, 0, 0.8);
				transform: scale(1.02);
				filter: none;
				border-color: #ff0000;
			}

			@keyframes shareButtonBlink {
				0%,
				100% {
					background-image: var(--noise-texture),
						linear-gradient(180deg, #330000 0%, #220000 40%, #110000 100%);
					box-shadow: inset 0 1px 2px rgba(255, 0, 0, 0.1),
						0 1px 2px rgba(0, 0, 0, 0.2), inset 0 0 0 1px rgba(255, 0, 0, 0.1),
						0 0 15px rgba(255, 0, 0, 0.3);
					text-shadow: 0 0 8px rgba(255, 0, 0, 0.5);
					border-color: #660000;
				}
				50% {
					background-image: var(--noise-texture),
						linear-gradient(180deg, #ff0000 0%, #cc0000 40%, #990000 100%);
					box-shadow: inset 0 1px 2px rgba(255, 255, 255, 0.3),
						0 1px 2px rgba(0, 0, 0, 0.2),
						inset 0 0 0 1px rgba(255, 255, 255, 0.3),
						0 0 30px rgba(255, 0, 0, 0.6);
					text-shadow: 0 0 15px rgba(255, 255, 255, 0.9);
					border-color: #ff3333;
				}
			}

			.control-button.share-ready:hover {
				animation: none;
				background: #ff0000;
				background-image: var(--noise-texture),
					linear-gradient(180deg, #ff3333 0%, #ff0000 40%, #cc0000 100%);
				filter: brightness(1.2);
				box-shadow: inset 0 1px 2px rgba(255, 255, 255, 0.4),
					0 0 30px rgba(255, 0, 0, 0.6);
				border-color: #ff6666;
				color: white;
				text-shadow: 0 0 15px rgba(255, 255, 255, 0.9);
			}

			.control-button.share-ready:active {
				transform: translateY(1px);
				filter: brightness(0.95);
				background: #cc0000;
				background-image: var(--noise-texture),
					linear-gradient(180deg, #cc0000 0%, #990000 40%, #660000 100%);
				box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3),
					0 0 20px rgba(255, 0, 0, 0.4);
				border-color: #990000;
			}

			/* Reset button in final game over state */
			.control-button.game-over {
				background: #1a1a1a;
				color: #fff;
				border: 1px solid #fff;
				box-shadow: 0 0 8px rgba(255, 255, 255, 0.2),
					inset 0 1px 2px rgba(255, 255, 255, 0.05);
				font-weight: 700;
				text-shadow: 0 0 5px rgba(255, 255, 255, 0.4);
			}

			.control-button.game-over:hover {
				filter: brightness(1.2);
				border-color: #fff;
				box-shadow: 0 0 10px rgba(255, 255, 255, 0.3),
					inset 0 1px 2px rgba(255, 255, 255, 0.1);
			}

			.control-button.game-over:active {
				transform: translateY(1px);
				filter: brightness(0.95);
				box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3),
					0 0 5px rgba(255, 255, 255, 0.2);
			}

			/* Power LED */
			.power-led {
				width: 6px;
				height: 6px;
				background: #33ff33;
				border-radius: 50%;
				box-shadow: 0 0 4px #33ff33, 0 0 6px #33ff33,
					inset 0 -1px 2px rgba(0, 0, 0, 0.2);
				border: 1px solid rgba(51, 255, 51, 0.4);
			}

			/* LED label */
			.power-text {
				font-family: 'Roboto Condensed', sans-serif;
				font-size: 12px;
				color: #666;
				text-transform: uppercase;
				letter-spacing: 0.1em;
				font-weight: 300;
			}

			/* Base button styles */
			.control-button {
				height: 36px;
				background: #1a1a1a;
				border: 1px solid #333;
				border-radius: 6px;
				position: relative;
				background-image: var(--noise-texture),
					linear-gradient(180deg, #1a1a1a 0%, #151515 40%, #111 100%);
				box-shadow: inset 0 1px 2px rgba(255, 255, 255, 0.05),
					0 1px 2px rgba(0, 0, 0, 0.2),
					inset 0 0 0 1px rgba(255, 255, 255, 0.05);
				cursor: pointer;
				user-select: none;
				transition: all 0.1s ease-out;
				font-family: 'Roboto Condensed', sans-serif;
				font-size: 12px;
				color: #666;
				text-transform: uppercase;
				letter-spacing: 0.1em;
				display: flex;
				align-items: center;
				justify-content: center;
				font-weight: 600;
				padding: 0 12px;
			}

			/* Controls row */
			.controls {
				display: flex;
				gap: 8px;
			}

			/* Mobile layout adjustments */
			@media (max-width: 768px) {
				.control-panel {
					flex-direction: column;
					gap: 12px;
					justify-content: center;
					padding: var(--tv-padding);
				}

				.top-row {
					justify-content: space-between;
					height: 32px;
					padding: 0;
				}

				.speaker-grille {
					width: 80px;
					height: 24px;
				}

				/* Move power to right side on non-touch devices */
				:not(.touch-device) .power-group-desktop {
					order: 3; /* Places it after the logo */
					margin: 0;
				}

				.controls {
					height: 32px;
					gap: 6px;
					justify-content: stretch;
					width: 100%;
					padding: 0;
				}

				.control-button {
					height: 32px;
					font-size: 11px;
					flex: 1;
					padding: 0 8px;
				}
			}

			/* Gamepad styles */
			.gamepad-row {
				display: none; /* Hidden by default */
				width: 100%;
				height: 120px;
				padding: 0;
				justify-content: space-between;
				align-items: center;
			}

			/* Add concave containers */
			.dpad-container {
				position: relative;
				padding: 6px;
				width: 108px;
				height: 108px;
				background: transparent;
				border-radius: 50%;
				/* Match concave gradient effect from action buttons */
				background-image: linear-gradient(
					145deg,
					rgba(0, 0, 0, 0.3) 0%,
					rgba(0, 0, 0, 0.1) 50%,
					rgba(0, 0, 0, 0.3) 100%
				);
				box-shadow:
					/* Subtle inner shadow */ inset 0 2px 4px rgba(0, 0, 0, 0.2);
			}

			.action-buttons-container {
				position: relative;
				padding: 8px;
				background: transparent;
				/* Maximum pill shape */
				border-radius: 999px;
				transform: rotate(-25deg) translateX(2px);
				/* Subtle concave gradient effect */
				background-image: linear-gradient(
					145deg,
					rgba(0, 0, 0, 0.3) 0%,
					rgba(0, 0, 0, 0.1) 50%,
					rgba(0, 0, 0, 0.3) 100%
				);
				box-shadow:
					/* Subtle inner shadow */ inset 0 2px 4px rgba(0, 0, 0, 0.2);
			}

			/* Unified D-pad as one piece */
			.dpad {
				position: relative;
				width: 96px;
				height: 96px;
				background: transparent;
			}

			/* Main D-pad shape */
			.dpad::before {
				content: '';
				position: absolute;
				top: 8px;
				left: 8px;
				right: 8px;
				bottom: 8px;
				background: #0a0a0a;
				/* Single SVG path for the D-pad shape */
				mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 96 96'%3E%3Cpath d='M36,0 C34,0 32,2 32,4 V32 H4 C2,32 0,34 0,36 V60 C0,62 2,64 4,64 H32 V92 C32,94 34,96 36,96 H60 C62,96 64,94 64,92 V64 H92 C94,64 96,62 96,60 V36 C96,34 94,32 92,32 H64 V4 C64,2 62,0 60,0 Z' fill='white'/%3E%3C/svg%3E");
				-webkit-mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 96 96'%3E%3Cpath d='M36,0 C34,0 32,2 32,4 V32 H4 C2,32 0,34 0,36 V60 C0,62 2,64 4,64 H32 V92 C32,94 34,96 36,96 H60 C62,96 64,94 64,92 V64 H92 C94,64 96,62 96,60 V36 C96,34 94,32 92,32 H64 V4 C64,2 62,0 60,0 Z' fill='white'/%3E%3C/svg%3E");
				/* Match action button glossy effect */
				background-image: linear-gradient(
					145deg,
					rgba(255, 255, 255, 0.07) 0%,
					rgba(255, 255, 255, 0.03) 30%,
					rgba(0, 0, 0, 0) 50%,
					rgba(0, 0, 0, 0.1) 100%
				);
				box-shadow:
					/* Outer edge */ 0 2px 4px rgba(0, 0, 0, 0.9),
					/* Drop shadow */ 0 3px 6px rgba(0, 0, 0, 0.5),
					/* Inner shadow */ inset 0 2px 4px rgba(0, 0, 0, 0.9),
					/* Subtle rim light */ inset 0 1px 1px rgba(255, 255, 255, 0.07);
				filter: brightness(0.9);
			}

			/* Add internal shapes for dimension */
			.dpad::after {
				content: '';
				position: absolute;
				top: 8px;
				left: 8px;
				right: 8px;
				bottom: 8px;
				/* SVG for internal shapes */
				background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 96 96'%3E%3Cpath d='M36,4 V30 A2,2 0 0,1 34,32 H6 A2,2 0 0,0 4,34 V62 A2,2 0 0,0 6,64 H34 A2,2 0 0,1 36,66 V92 A2,2 0 0,0 38,94 H58 A2,2 0 0,0 60,92 V66 A2,2 0 0,1 62,64 H90 A2,2 0 0,0 92,62 V34 A2,2 0 0,0 90,32 H62 A2,2 0 0,1 60,30 V4 A2,2 0 0,0 58,2 H38 A2,2 0 0,0 36,4' fill='none' stroke='rgba(0,0,0,0.7)' stroke-width='2'/%3E%3Cpath d='M36,8 V28 A4,4 0 0,1 32,32 H8 A4,4 0 0,0 4,36 V60 A4,4 0 0,0 8,64 H32 A4,4 0 0,1 36,68 V88 A4,4 0 0,0 40,92 H56 A4,4 0 0,0 60,88 V68 A4,4 0 0,1 64,64 H88 A4,4 0 0,0 92,60 V36 A4,4 0 0,0 88,32 H64 A4,4 0 0,1 60,28 V8 A4,4 0 0,0 56,4 H40 A4,4 0 0,0 36,8' fill='none' stroke='rgba(255,255,255,0.02)' stroke-width='1'/%3E%3C/svg%3E");
				pointer-events: none;
				opacity: 0.9;
			}

			/* Invisible button overlays */
			.dpad-button {
				position: absolute;
				width: 32px;
				height: 32px;
				background: transparent;
				z-index: 3;
				cursor: pointer;
			}

			/* Position buttons */
			.dpad-button[data-direction='up'] {
				top: 0;
				left: 32px;
				height: 36px;
			}

			.dpad-button[data-direction='right'] {
				top: 32px;
				right: 0;
				width: 36px;
			}

			.dpad-button[data-direction='down'] {
				bottom: 0;
				left: 32px;
				height: 36px;
			}

			.dpad-button[data-direction='left'] {
				top: 32px;
				left: 0;
				width: 36px;
			}

			/* Depression effects */
			.dpad-button:active ~ .dpad::before {
				filter: brightness(0.85);
				background-image: linear-gradient(
					145deg,
					rgba(0, 0, 0, 0.1) 0%,
					rgba(0, 0, 0, 0.05) 30%,
					rgba(0, 0, 0, 0.1) 50%,
					rgba(0, 0, 0, 0.15) 100%
				);
				box-shadow:
					/* Maintain edge */ 0 1px 2px rgba(0, 0, 0, 0.6),
					/* Pressed drop shadow */ 0 2px 4px rgba(0, 0, 0, 0.4),
					/* Deeper inner shadow */ inset 0 2px 5px rgba(0, 0, 0, 1);
				transform: translateY(1px);
			}

			/* Adjust internal shapes when pressed */
			.dpad-button:active ~ .dpad::after {
				opacity: 0.7;
				filter: brightness(0.8);
			}

			/* Direction-specific depression effects */
			.dpad-button[data-direction='up']:active ~ .dpad::before {
				transform-origin: center bottom;
				transform: perspective(200px) rotateX(-1deg);
			}

			.dpad-button[data-direction='down']:active ~ .dpad::before {
				transform-origin: center top;
				transform: perspective(200px) rotateX(1deg);
			}

			.dpad-button[data-direction='left']:active ~ .dpad::before {
				transform-origin: right center;
				transform: perspective(200px) rotateY(1deg);
			}

			.dpad-button[data-direction='right']:active ~ .dpad::before {
				transform-origin: left center;
				transform: perspective(200px) rotateY(-1deg);
			}

			/* Action buttons with smoother gloss */
			.action-button {
				position: relative;
				width: 48px;
				height: 48px;
				background: #111111;
				border: none;
				border-radius: 50%;
				display: flex;
				align-items: center;
				justify-content: center;
				color: transparent;
				cursor: pointer;
				user-select: none;
				/* Smoother glossy effect */
				background-image: linear-gradient(
					145deg,
					rgba(255, 255, 255, 0.07) 0%,
					rgba(255, 255, 255, 0.03) 30%,
					rgba(0, 0, 0, 0) 50%,
					rgba(0, 0, 0, 0.1) 100%
				);
				box-shadow:
					/* Outer edge */ 0 2px 4px rgba(0, 0, 0, 0.9),
					/* Drop shadow */ 0 3px 6px rgba(0, 0, 0, 0.5),
					/* Inner shadow */ inset 0 2px 4px rgba(0, 0, 0, 0.9),
					/* Subtle rim light */ inset 0 1px 1px rgba(255, 255, 255, 0.07);
			}

			.action-button:active {
				transform: scale(0.98);
				filter: brightness(0.9);
				background-image: linear-gradient(
					145deg,
					rgba(0, 0, 0, 0.1) 0%,
					rgba(0, 0, 0, 0.05) 30%,
					rgba(0, 0, 0, 0.1) 50%,
					rgba(0, 0, 0, 0.15) 100%
				);
				box-shadow:
					/* Maintain edge */ 0 1px 2px rgba(0, 0, 0, 0.6),
					/* Pressed drop shadow */ 0 2px 4px rgba(0, 0, 0, 0.4),
					/* Deeper inner shadow */ inset 0 2px 5px rgba(0, 0, 0, 1);
			}

			/* Show gamepad only on mobile */
			@media (max-width: 768px) {
				.gamepad-row {
					display: flex;
					order: -1; /* Move above top row */
				}

				.control-panel {
					padding-top: 12px; /* Add padding at top for gamepad */
				}
			}

			/* Debossed labels directly on buttons */
			.action-button::after {
				content: attr(data-action);
				position: absolute;
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%) rotate(25deg); /* Counter-rotate to make labels vertical */
				color: transparent;
				font-family: 'Roboto Condensed', sans-serif;
				font-size: 20px;
				font-weight: 700;
				text-transform: uppercase;
				/* Create debossed effect */
				background: linear-gradient(
					145deg,
					rgba(0, 0, 0, 0.8) 0%,
					rgba(0, 0, 0, 0.5) 100%
				);
				-webkit-background-clip: text;
				background-clip: text;
				/* Add subtle shadow for depth */
				text-shadow: 0px 1px 1px rgba(255, 255, 255, 0.02),
					0px -1px 1px rgba(0, 0, 0, 0.9);
			}

			/* Adjust label when button is pressed */
			.action-button:active::after {
				transform: translate(-50%, -50%) rotate(25deg) scale(0.98);
				text-shadow: 0px 1px 1px rgba(255, 255, 255, 0.01),
					0px -1px 1px rgba(0, 0, 0, 1);
			}

			/* Action buttons container */
			.action-buttons {
				position: relative;
				display: flex;
				gap: 20px;
				margin: 4px;
				/* Remove rotation since container is already rotated */
				transform: none;
			}

			/* Base styles for non-touch devices */
			.gamepad-row {
				display: none;
			}

			.speaker-grille-right {
				display: none;
			}

			.power-group-mobile {
				display: none;
			}

			/* Touch device styles */
			.touch-device .gamepad-row {
				display: flex;
				order: -1;
				position: relative;
				padding: 0;
				justify-content: space-between;
				align-items: center;
			}

			.touch-device .speaker-grille-right {
				display: block;
				width: 80px;
				height: 24px;
			}

			.touch-device .power-group-desktop {
				display: none;
			}

			.touch-device .power-group-mobile {
				display: flex;
				position: absolute;
				left: 50%;
				top: 50%;
				transform: translate(-50%, -50%);
				flex-direction: column;
				align-items: center;
				gap: 4px;
				z-index: 2;
			}

			.touch-device .control-panel {
				flex-direction: column;
				gap: 12px;
				justify-content: center;
			}

			.touch-device .top-row {
				justify-content: space-between;
				height: 32px;
			}

			.touch-device .speaker-grille {
				width: 80px;
				height: 24px;
			}

			.touch-device .controls {
				height: 32px;
				gap: 6px;
				justify-content: stretch;
				width: 100%;
			}

			.touch-device .control-button {
				height: 32px;
				font-size: 11px;
				flex: 1;
				padding: 0 8px;
			}

			/* Desktop styles */
			@media (min-width: 769px) {
				.control-panel {
					flex-direction: row;
					align-items: center;
				}

				.top-row {
					flex: 1;
					justify-content: flex-start;
					gap: 20px;
					position: initial;
				}

				.speaker-grille {
					margin-right: 20px;
				}

				.power-group-desktop {
					order: 1;
				}

				.controls {
					min-width: 240px;
					justify-content: flex-end;
				}

				.control-button {
					width: 72px;
				}
			}

			/* Mobile optimizations */
			@media (max-width: 768px) {
				.canvas-container {
					inset: calc(var(--tv-padding) * 0.5);
				}

				#gameCanvas {
					will-change: transform;
					backface-visibility: hidden;
					perspective: 1000;
					transform: translateZ(0);
				}

				.game-wrapper {
					will-change: transform;
					backface-visibility: hidden;
					perspective: 1000;
					transform: translateZ(0);
				}
			}
		</style>
	</head>
	<body>
		<div class="tv-container">
			<div class="monitor-frame">
				<div class="inner-bezel">
					<div class="canvas-container">
						<div class="game-wrapper">
							<canvas id="gameCanvas"></canvas>
						</div>
					</div>
				</div>
				<div class="control-panel">
					<div class="top-row">
						<div class="speaker-grille"></div>
						<div class="power-group-desktop">
							<div class="power-led"></div>
							<div class="power-text">POWER</div>
						</div>
						<div class="brand-logo">FWD:VISION</div>
						<div class="speaker-grille speaker-grille-right"></div>
					</div>
					<div class="gamepad-row">
						<div class="dpad-container">
							<div class="dpad-button" data-direction="up"></div>
							<div class="dpad-button" data-direction="left"></div>
							<div class="dpad-button" data-direction="down"></div>
							<div class="dpad-button" data-direction="right"></div>
							<div class="dpad"></div>
						</div>
						<div class="power-group-mobile">
							<div class="power-led"></div>
							<div class="power-text">POWER</div>
						</div>
						<div class="action-buttons-container">
							<div class="action-buttons">
								<div class="action-button" data-action="b">B</div>
								<div class="action-button" data-action="a">A</div>
							</div>
						</div>
					</div>
					<div class="controls">
						<div
							class="control-button"
							onclick="window.open('https://fwdfwdfwd.email', '_blank')"
							data-action="info"
						>
							INFO
						</div>
						<div
							class="control-button"
							id="resetButton"
							onclick="window.location.reload()"
							data-action="reset"
						>
							RESET
						</div>
						<div
							class="control-button"
							id="shareButton"
							disabled
							onclick="shareScore()"
							data-action="share"
						>
							SHARE
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Error handling and debugging -->
		<script>
			console.log('Starting script initialization...')

			// Global error handler
			window.onerror = function (msg, url, lineNo, columnNo, error) {
				console.error('Global error:', {
					message: msg,
					url: url,
					line: lineNo,
					column: columnNo,
					error: error,
				})
				return false
			}

			// Unhandled promise rejection handler
			window.onunhandledrejection = function (event) {
				console.error('Unhandled promise rejection:', event.reason)
			}

			// DOM ready handler
			document.addEventListener('DOMContentLoaded', function () {
				console.log('DOM loaded, elements:', {
					gameCanvas: document.getElementById('gameCanvas'),
					effectCanvas: document.getElementById('effectCanvas'),
					wrapper: document.querySelector('.game-wrapper'),
				})
			})

			// Create a promise to coordinate power-on with game init
			window.powerOnComplete = new Promise((resolve) => {
				window.completePowerOn = resolve
			})

			// Load complete handler
			window.addEventListener('load', function () {
				// Remove any duplicate canvases that might exist
				document
					.querySelectorAll(
						'#gameCanvas:not(:first-of-type), #effectCanvas:not(:first-of-type)'
					)
					.forEach((el) => el.remove())

				// Power on sequence
				const leds = document.querySelectorAll('.power-led')
				const canvas = document.getElementById('gameCanvas')
				const effectCanvas = document.getElementById('effectCanvas')

				if (leds.length && canvas && effectCanvas) {
					// Start with screen and LED off
					canvas.style.transition = 'none'
					effectCanvas.style.transition = 'none'
					canvas.style.transform = 'scaleY(0.005)'
					effectCanvas.style.transform = 'scaleY(0.005)'
					canvas.style.filter = 'brightness(0)'
					effectCanvas.style.filter = 'brightness(0)'

					leds.forEach((led) => {
						led.style.background = '#1a1a1a'
						led.style.boxShadow = 'none'
						led.style.border = '1px solid rgba(0, 0, 0, 0.4)'
					})

					// Force reflow
					canvas.offsetHeight

					// Start power on sequence
					setTimeout(() => {
						// Turn on LEDs
						leds.forEach((led) => {
							led.style.background = '#33ff33'
							led.style.boxShadow =
								'0 0 4px #33ff33, 0 0 6px #33ff33, inset 0 -1px 2px rgba(0, 0, 0, 0.2)'
							led.style.border = '1px solid rgba(51, 255, 51, 0.4)'
						})

						// Start screen power on
						canvas.style.opacity = '1'
						effectCanvas.style.opacity = '1'
						canvas.style.transition = 'all 0.3s ease-out'
						effectCanvas.style.transition = 'all 0.3s ease-out'
						canvas.style.transform = 'none'
						effectCanvas.style.transform = 'none'
						canvas.style.filter = 'brightness(1)'
						effectCanvas.style.filter = 'brightness(1)'

						// Signal power-on complete after transition
						setTimeout(() => {
							window.completePowerOn()
						}, 300)
					}, 100)
				} else {
					// If elements not found, signal completion immediately
					window.completePowerOn()
				}
			})
		</script>

		<!-- Game scripts -->
		<script src="https://pixijs.download/v7.4.0/pixi.min.js"></script>
		<script src="https://filters.pixijs.download/v5.1.1/pixi-filters.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/@pixi/sound@5.2.2/dist/pixi-sound.js"></script>
		<script>
			// Wait for scripts to load before initializing game
			window.addEventListener('load', () => {
				if (PIXI.filters && PIXI.filters.CRTFilter) {
					console.log('PixiJS and filters loaded successfully')
				} else {
					console.error('Failed to load PixiJS filters')
				}

				// Check if PIXI.sound loaded
				if (PIXI.sound) {
					console.log('PIXI Sound loaded successfully')
				} else {
					console.error('Failed to load PIXI Sound')
				}
			})
		</script>
		<script type="module" src="game.js"></script>

		<!-- Add sharing functionality -->
		<script>
			// Konami code sequence
			const konamiCode = [
				'ArrowUp',
				'ArrowUp',
				'ArrowDown',
				'ArrowDown',
				'ArrowLeft',
				'ArrowRight',
				'ArrowLeft',
				'ArrowRight',
				'b',
				'a',
			]
			let konamiIndex = 0
			let cheatMode = false
			let waitingForAB = false // New flag to track if we're waiting for A/B input

			// Function to reset Konami state
			function resetKonamiState() {
				konamiIndex = 0
				waitingForAB = false
			}

			// Initialize gamepad controls
			document.addEventListener('DOMContentLoaded', () => {
				// Add button sounds - different for control panel vs gamepad
				document.querySelectorAll('.control-button').forEach((button) => {
					// Play control panel button sound
					const playButtonSound = (e) => {
						e.preventDefault() // Prevent default to avoid double triggers
						const buttonSound = new Audio('audio/button.mp3')
						buttonSound.play()
					}

					// Remove any existing listeners first
					button.removeEventListener('mousedown', playButtonSound)
					button.removeEventListener('touchstart', playButtonSound)

					// Add single event listener that handles both touch and mouse
					button.addEventListener('pointerdown', playButtonSound, {
						passive: false,
					})
				})

				// Add gamepad button sounds
				document
					.querySelectorAll('.dpad-button, .action-button')
					.forEach((button) => {
						// Play gamepad button sound
						const playButtonSound = (e) => {
							e.preventDefault() // Prevent default to avoid double triggers
							const buttonSound = new Audio('audio/click.mp3')
							buttonSound.play()
						}

						// Remove any existing listeners first
						button.removeEventListener('mousedown', playButtonSound)
						button.removeEventListener('touchstart', playButtonSound)

						// Add single event listener that handles both touch and mouse
						button.addEventListener('pointerdown', playButtonSound, {
							passive: false,
						})
					})

				// Handle D-pad and action buttons
				const dpadButtons = document.querySelectorAll('.dpad-button')
				const actionButtons = document.querySelectorAll('.action-button')

				// Map touch events for D-pad buttons
				dpadButtons.forEach((button) => {
					const direction = button.dataset.direction

					// Create a persistent handler function
					button.pressHandler = (e) => {
						e.preventDefault()
						e.stopPropagation()
						if (window.konamiState) {
							window.konamiState.handleInput(
								'Arrow' + direction.charAt(0).toUpperCase() + direction.slice(1)
							)
						}
					}

					// Remove any existing listeners using the stored handler
					button.removeEventListener('pointerdown', button.pressHandler)
					button.removeEventListener('touchstart', button.pressHandler)
					button.removeEventListener('mousedown', button.pressHandler)

					// Add single event listener that handles both touch and mouse
					button.addEventListener('pointerdown', button.pressHandler)
				})

				// Map touch events for action buttons
				actionButtons.forEach((button) => {
					const action = button.dataset.action

					// Create handler that checks Konami state before triggering game input
					const handlePress = (e) => {
						e.preventDefault()
						e.stopPropagation()

						// Check if we're waiting for B/A input for Konami code
						if (window.konamiState && window.konamiState.isWaitingForAB()) {
							// Check if this button press is the next expected Konami code input
							const nextExpectedInput =
								window.konamiState.code[window.konamiState.getIndex()]
							const isNextKonamiInput =
								nextExpectedInput.toLowerCase() === action.toLowerCase()

							console.log('BA Check:', {
								action,
								nextExpected: nextExpectedInput,
								isNext: isNextKonamiInput,
								index: window.konamiState.getIndex(),
							})

							// Handle the input if it's correct
							if (isNextKonamiInput) {
								window.konamiState.handleInput(action.toLowerCase())
							}

							// Always return during BA sequence, regardless of correct/incorrect input
							return
						}

						// Don't allow game input during completion
						if (window.konamiState && window.konamiState.isCompletingKonami()) {
							return
						}

						// Normal game input if not in Konami sequence
						if (window.game && window.game.handleInput) {
							window.game.handleInput()
						}
					}

					// Remove any existing listeners
					button.removeEventListener('pointerdown', handlePress)
					button.removeEventListener('touchstart', handlePress)
					button.removeEventListener('mousedown', handlePress)

					// Add listeners for both touch and click
					button.addEventListener('pointerdown', handlePress, {
						passive: false,
					})
					button.addEventListener('touchstart', handlePress, { passive: false })
					button.addEventListener('mousedown', handlePress)

					console.log('Handler attached to button:', action)
				})

				const b = document.getElementById('shareButton')
				if (b) {
					b.disabled = false
					b.classList.remove('share-ready')
					window.shareData = null
				}
			})

			// Function to flash power LED
			function flashPowerLED(color, duration = 100) {
				const leds = document.querySelectorAll('.power-led')
				if (!leds.length) {
					console.warn('Power LED elements not found')
					return
				}

				console.log('Flashing LEDs:', color)

				leds.forEach((led) => {
					// Store original styles
					const originalBackground = led.style.background
					const originalBoxShadow = led.style.boxShadow
					const originalBorder = led.style.border

					// Set flash styles
					led.style.background = color
					led.style.boxShadow = `0 0 4px ${color}, 0 0 6px ${color}, inset 0 -1px 2px rgba(0, 0, 0, 0.2)`
					led.style.border = `1px solid ${color}40`

					// Reset after duration
					setTimeout(() => {
						led.style.background = originalBackground || '#33ff33'
						led.style.boxShadow =
							originalBoxShadow ||
							'0 0 4px #33ff33, 0 0 6px #33ff33, inset 0 -1px 2px rgba(0, 0, 0, 0.2)'
						led.style.border =
							originalBorder || '1px solid rgba(51, 255, 51, 0.4)'
					}, duration)
				})
			}

			// Separate function to activate cheat mode
			function activateCheatMode() {
				console.log('Activating cheat mode...')

				// Play Konami sound effect first
				const konamiSound = new Audio('audio/konami.mp3')
				konamiSound.play().catch((e) => console.log('Konami sound failed:', e))

				// Flash power LED red rapidly for cheat activation
				let flashCount = 0
				const flashInterval = setInterval(() => {
					if (flashCount >= 6) {
						clearInterval(flashInterval)
						return
					}
					flashPowerLED('#ff3333', 50)
					flashCount++
				}, 100)

				// Delay the actual cheat mode activation slightly
				setTimeout(() => {
					// Set all cheat mode flags and settings
					cheatMode = true
					window.cheatMode = true
					window.gameSpeed = 0.5
					window.cheatPoints = 10

					// Update game HUD to show cheat mode
					if (window.game) {
						window.game.updateHUD()
					}

					// Create or update cheat mode indicator
					let cheatIndicator = document.getElementById('cheatIndicator')
					if (cheatIndicator) {
						cheatIndicator.remove()
					}

					console.log('Game state updated:', {
						cheatMode: window.cheatMode,
						gameSpeed: window.gameSpeed,
						cheatPoints: window.cheatPoints,
					})

					// Reset Konami sequence and restore game input
					konamiIndex = 0
					waitingForAB = false
					console.log('Cheat mode activated and game input restored')
				}, 100)
			}

			// Add reset handler for cheat mode
			const resetCheatMode = () => {
				console.log('Resetting cheat mode...')
				cheatMode = false
				window.cheatMode = false
				window.gameSpeed = 1
				window.cheatPoints = 0
				const cheatIndicator = document.getElementById('cheatIndicator')
				if (cheatIndicator) {
					cheatIndicator.remove()
				}
				console.log('Cheat mode reset complete')
			}

			// Update reset button click handler
			document.getElementById('resetButton').onclick = (e) => {
				e.preventDefault()

				// Prevent multiple clicks
				const resetButton = document.getElementById('resetButton')
				if (resetButton) {
					resetButton.onclick = null
					resetButton.style.pointerEvents = 'none'
				}

				// Play turn off sound
				const turnOffSound = new Audio('audio/turn-off.mp3')
				turnOffSound.play()

				// Power down sequence
				const leds = document.querySelectorAll('.power-led')
				const canvas = document.getElementById('gameCanvas')

				if (leds.length) {
					// Flash red briefly then turn off
					leds.forEach((led) => {
						led.style.background = '#ff3333'
						led.style.boxShadow =
							'0 0 4px #ff3333, 0 0 6px #ff3333, inset 0 -1px 2px rgba(0, 0, 0, 0.2)'
						led.style.border = '1px solid rgba(255, 51, 51, 0.4)'

						setTimeout(() => {
							led.style.background = '#1a1a1a'
							led.style.boxShadow = 'none'
							led.style.border = '1px solid rgba(0, 0, 0, 0.4)'
						}, 100)
					})
				}

				// CRT power down effect
				if (canvas) {
					// Create white flash
					canvas.style.transition = 'all 0.1s ease-out'
					canvas.style.filter = 'brightness(1.5) contrast(1.2)'

					setTimeout(() => {
						// Horizontal collapse with slight curve
						canvas.style.transition = 'all 0.15s ease-in'
						canvas.style.transform =
							'scaleY(0.005) perspective(500px) rotateX(5deg)'
						canvas.style.filter = 'brightness(1) contrast(1.5)'

						setTimeout(() => {
							// Fade to black
							canvas.style.opacity = '0'

							// Reset cheat mode and reload after effects
							setTimeout(() => {
								resetCheatMode()
								window.location.reload()
							}, 400)
						}, 150)
					}, 100)
				} else {
					// Fallback if elements not found
					resetCheatMode()
					window.location.reload()
				}
			}

			const shareScore = async () => {
				try {
					const isFinalKnockout =
						window.shareData && window.shareData.roundsLeft === 0
					const text = isFinalKnockout
						? `I clapped cheeks and got ${window.shareData.score} points!`
						: `Come clap some cheeks with me!`
					const url = 'https://clappycheeks.com'

					// Check if Web Share API is available
					if (navigator.canShare) {
						const shareData = {
							title: 'Clappy Cheeks',
							text: text,
							url: url,
						}

						// Check if we can share this data
						if (navigator.canShare(shareData)) {
							try {
								await navigator.share(shareData)
								return
							} catch (e) {
								console.log('Web Share API failed:', e)
							}
						}
					}

					// Fallback to clipboard
					try {
						await navigator.clipboard.writeText(text + ' ' + url)
						alert('Copied to clipboard!')
					} catch (e) {
						console.log('Clipboard API failed:', e)
					}
				} catch (e) {
					console.error('Share failed:', e)
				}
			}

			window.onGameEnd = (score, isGameOver, roundsLeft) => {
				const b = document.getElementById('shareButton')
				const r = document.getElementById('resetButton')
				if (b) {
					window.shareData = { score, roundsLeft }

					if (roundsLeft === 0) {
						b.classList.add('share-ready')
						if (r) r.classList.add('game-over')
					} else {
						b.classList.remove('share-ready')
						if (r) r.classList.remove('game-over')
					}
				}
			}

			window.addEventListener('gameEnd', (e) => {
				if (e.detail) {
					window.onGameEnd(
						e.detail.score,
						e.detail.isGameOver,
						e.detail.roundsLeft
					)
				}
			})
		</script>

		<!-- Add touch detection script -->
		<script>
			document.addEventListener('DOMContentLoaded', () => {
				// Function to check if device supports touch
				function isTouchDevice() {
					return (
						'ontouchstart' in window ||
						navigator.maxTouchPoints > 0 ||
						navigator.msMaxTouchPoints > 0
					)
				}

				// Add touch-device class if touch is supported
				if (isTouchDevice()) {
					document.body.classList.add('touch-device')
				}

				// Prevent zoom on double tap
				let lastTouchEnd = 0
				document.addEventListener(
					'touchend',
					(event) => {
						const now = Date.now()
						if (now - lastTouchEnd <= 300) {
							event.preventDefault()
						}
						lastTouchEnd = now
					},
					{ passive: false }
				)

				// Prevent zoom on pinch
				document.addEventListener(
					'touchmove',
					(event) => {
						if (event.touches.length > 1) {
							event.preventDefault()
						}
					},
					{ passive: false }
				)

				// Prevent zoom on gesture
				document.addEventListener(
					'gesturestart',
					(event) => {
						event.preventDefault()
					},
					{ passive: false }
				)

				// Lock viewport on orientation change
				window.addEventListener('orientationchange', () => {
					const meta = document.querySelector('meta[name="viewport"]')
					if (meta) {
						meta.setAttribute(
							'content',
							'width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, viewport-fit=cover'
						)
					}
				})
			})
		</script>
	</body>
</html>
